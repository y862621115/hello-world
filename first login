package Bean;

public class UserBean {
	String username,password;

	public String getUsername() {
		return username;
	}

	public void setUsername(String username) {
		this.username = username;
	}

	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}
	
}





package Dao;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import Bean.UserBean;
import util.DBUtil;

public class UserDao {
	private static Connection con;
	private static Statement state;
	private static ResultSet rs;
	public UserDao(){};
	
	public Boolean login(String username,String password){
		con = DBUtil.getConnection();
		state = null;
		rs = null;
		Boolean b=false;
		String sql = "select username, password from [user] where username='" + username + "' and password = '"+password +"' ";
		try {
			state = con.createStatement();
			rs = state.executeQuery(sql);
			//System.out.println(rs.next()+name1+" "+name2);
			if (rs.next()){
				b=true;
			}
		}catch (SQLException e) {
			e.printStackTrace();
		}
		DBUtil.close(rs, state, con);
		return b;
	};
	
	public void add(UserBean userBean){
		con = DBUtil.getConnection();
		state = null;
		rs = null;
		String sql = "insert into [user] ( username , password ) values ( '"+userBean.getUsername()+"','"+userBean.getPassword()+"' )";
		
		try {
			state = con.createStatement();
			state.execute(sql);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		DBUtil.close(rs, state, con);
	}
	
}





package Servlet;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import Bean.UserBean;
import Dao.UserDao;

/**
 * Servlet implementation class UserServlet
 */
@WebServlet("/UserServlet")
public class UserServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
	  public UserServlet() {
	        super();
	        // TODO Auto-generated constructor stub
	    }

		
		protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
			request.setCharacterEncoding("UTF-8");
			String method = request.getParameter("method");
			if("login".equals(method)){
				login(request,response);
			}else if("reg".equals(method)){
				reg(request,response);
			}
		}
	protected void login(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("UTF-8");
		String username=request.getParameter("username");
		String password=request.getParameter("password");
		UserDao userDao=new UserDao();
		if(userDao.login(username, password)){
			response.sendRedirect(request.getContextPath()+"/success.jsp");
		}else{
			response.sendRedirect(request.getContextPath()+"/login.jsp");
		}
	}

	protected void reg(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("UTF-8");
		String username=request.getParameter("username");
		String password=request.getParameter("password");
		UserBean userBean=new UserBean();
		userBean.setUsername(username);
		userBean.setPassword(password);
		UserDao userDao=new UserDao();
		userDao.add(userBean);
		response.sendRedirect(request.getContextPath()+"/add.jsp");
	}
}








package util;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;



/**
 * 数据库工具类，用来连接数据库，执行SQL语句，关闭数据库连接等。
 * @version 1
 */
public class DBUtil {

	public DBUtil() {
	}
	
	 private static String driverName="com.microsoft.sqlserver.jdbc.SQLServerDriver";
	 private  static String dbURL="jdbc:sqlserver://localhost:1433;DatabaseName=MYDB";
	 private  static String userName="sa";
	 private  static String userPwd="SQLpassword";
	
	
	/**
	 * 返回一个数据库的连接对象的应用
	 * @return
	 */
	public static Connection getConnection(){
		 Connection dbConn=null;
		 try
		{
			Class.forName(driverName);
			//System.out.println("加载驱动成功！");
		}catch(Exception e){
			e.printStackTrace();
			System.out.println("加载驱动失败！");
		}
		try{
			dbConn=DriverManager.getConnection(dbURL,userName,userPwd);
				//System.out.println("连接数据库成功！");
		}catch(Exception e)
		{
			e.printStackTrace();
			System.out.print("SQL Server连接失败！");
		}
		return dbConn;	
	}
	
	/**
	 * 关闭数据库的连接对象，SQL语句对象
	 * @param state sql语句对象
	 * @param con	数据库连接对象
	 */
	public static void close(Statement state,Connection con){
		if(state!=null){
			try {
				state.close();
			} catch (SQLException e) {
			}
		}
		
		if(con!=null)
			try {
				con.close();
			} catch (SQLException e) {
			}
	}
	
	/**
	 * 关闭数据库的连接对象，SQL语句对象，查询结果集对象
	 * 
	 * @param rs		结果集对象
	 * @param state		Statement对象
	 * @param con		Connection对象
	 */
	public static void close(ResultSet rs,java.sql.Statement state,Connection con){
		
		if(rs!=null)
			try {
				rs.close();
			} catch (SQLException e) {
			}
		if(state!=null)
			try {
				state.close();
			} catch (SQLException e) {
			}
		if(con!=null)
			try {
				con.close();
			} catch (SQLException e) {
			}
		
	}
	
}




<%@ page language="java" contentType="text/html;charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPEhtmlPUBLIC"-//W3C//DTD HTML 4.01Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type"content="text/html; charset=UTF-8">
<title>登陆</title>
</head>
<body>
	<center>
	<form action="${pageContext.request.contextPath }/UserServlet?method=login"method="post">
		用户名：<input type="text" name="username"><br>	
		密码：<input type="password" name="password"><br>	
		<button>登陆</button>
		<a href="${pageContext.request.contextPath }/reg.jsp"><button type="button">注册</button></a>
	</form>
	</center>
</body>
</html>



<%@ page language="java" contentType="text/html;charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPEhtmlPUBLIC"-//W3C//DTD HTML 4.01Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type"content="text/html; charset=UTF-8">
<title>注册</title>
</head>
<body>
	<center>
	<form action="${pageContext.request.contextPath }/UserServlet?method=reg"method="post">
		
		用户名：<input type="text" name="username"><br>	
		密码：<input type="password" name="password"><br>	
	
		<button>注册</button>
		<a href="${pageContext.request.contextPath }/login.jsp"><button type="button">返回</button></a>
	</form>
	</center>
</body>
</html>



<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>主页</title>
</head>
<body>
	<h1>登陆成功</h1>
</body>
</html>
